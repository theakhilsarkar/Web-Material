# üîê React + Auth0 Authentication (with Protected Routes)

This guide shows how to set up **Auth0 authentication in a React project** and protect routes such as `/profile`.  
We‚Äôll use:

- **React Router v6** for routing
- **Auth0 React SDK** (`@auth0/auth0-react`) for authentication
- **Private Route Wrapper** to protect pages

---

## 1Ô∏è‚É£ Install Dependencies

```bash
npm install @auth0/auth0-react react-router-dom
```

---

## 2Ô∏è‚É£ Setup Auth0 Provider

Wrap your app with `Auth0Provider` so the SDK can manage authentication globally.  
We‚Äôll also use React Router‚Äôs `navigate` for clean redirects.

üìå **`index.js`**
```jsx
import React from "react";
import { createRoot } from "react-dom/client";
import "./index.css";
import App from "./App.jsx";
import { Auth0Provider } from "@auth0/auth0-react";
import { BrowserRouter, useNavigate } from "react-router-dom";

// Custom wrapper to use React Router navigation inside Auth0Provider
const Auth0ProviderWithNavigate = ({ children }) => {
  const navigate = useNavigate();

  // Callback after Auth0 login
  const onRedirectCallback = (appState) => {
    // Navigate to the page user wanted, or fallback to "/"
    navigate(appState?.returnTo || window.location.pathname, { replace: true });
  };

  return (
    <Auth0Provider
      domain="YOUR_AUTH0_DOMAIN"              // e.g. dev-xyz123.us.auth0.com
      clientId="YOUR_AUTH0_CLIENT_ID"         // from Auth0 dashboard
      authorizationParams={{
        redirect_uri: window.location.origin, // redirect back to app after login
      }}
      cacheLocation="localstorage"            // persist login on refresh
      useRefreshTokens={true}                 // keep session alive
      onRedirectCallback={onRedirectCallback} // handle navigation after login
    >
      {children}
    </Auth0Provider>
  );
};

createRoot(document.getElementById("root")).render(
  <BrowserRouter>
    <Auth0ProviderWithNavigate>
      <App />
    </Auth0ProviderWithNavigate>
  </BrowserRouter>
);
```

---

## 3Ô∏è‚É£ Add Login / Logout Buttons

üìå **`AuthButtons.jsx`**
```jsx
import React from "react";
import { useAuth0 } from "@auth0/auth0-react";

export default function AuthButtons() {
  const { loginWithRedirect, logout, isAuthenticated } = useAuth0();

  return (
    <div>
      {isAuthenticated ? (
        // Show logout if user is logged in
        <button
          onClick={() =>
            logout({
              logoutParams: { returnTo: window.location.origin }, // back to home
            })
          }
        >
          Log Out
        </button>
      ) : (
        // Show login button if user is logged out
        <button
          onClick={() =>
            loginWithRedirect({
              appState: { returnTo: "/profile" }, // redirect to profile after login
            })
          }
        >
          Log In
        </button>
      )}
    </div>
  );
}
```

---

## 4Ô∏è‚É£ Create Protected Route Wrapper

This component checks if a user is authenticated before showing a page.

üìå **`PrivateRoutes.jsx`**
```jsx
import React from "react";
import { useAuth0 } from "@auth0/auth0-react";
import { Navigate, useLocation } from "react-router-dom";

export default function PrivateRoutes({ children }) {
  const { isAuthenticated, isLoading } = useAuth0();
  const location = useLocation();

  if (isLoading) return <p>Loading...</p>;

  if (!isAuthenticated) {
    // Redirect unauthenticated users to Home ("/")
    // while preserving the route they tried
    return <Navigate to="/" state={{ from: location }} replace />;
  }

  return children; // Render protected page
}
```

---

## 5Ô∏è‚É£ Create Profile Component (Protected Page)

üìå **`Profile.jsx`**
```jsx
import React from "react";
import { useAuth0 } from "@auth0/auth0-react";

export default function Profile() {
  const { user, isAuthenticated, isLoading } = useAuth0();

  if (isLoading) return <p>Loading...</p>;

  return (
    isAuthenticated && (
      <div>
        <h2>Welcome {user.name} üéâ</h2>
        <p>Email: {user.email}</p>
      </div>
    )
  );
}
```

---

## 6Ô∏è‚É£ Define Routes

Set up `Home` (public) and `Profile` (protected) routes.

üìå **`App.js`**
```jsx
import "./App.css";
import { Route, Routes } from "react-router-dom";
import AuthButtons from "./components/AuthButtons";
import Profile from "./components/Profile";
import PrivateRoutes from "./components/PrivateRoutes";

function App() {
  return (
    <>
      {/* Login/Logout buttons always visible */}
      <AuthButtons />

      <Routes>
        {/* Public route */}
        <Route path="/" element={<h2>Home Page</h2>} />

        {/* Protected route */}
        <Route
          path="/profile"
          element={
            <PrivateRoutes>
              <Profile />
            </PrivateRoutes>
          }
        />
      </Routes>
    </>
  );
}

export default App;
```

---

## 7Ô∏è‚É£ Test the Flow

1. Start the React app ‚Üí `npm run dev` (or `npm start`)  
2. Open [http://localhost:3000](http://localhost:3000)  
3. Click **Login** ‚Üí Auth0 login page opens  
4. After login, you are redirected to `/profile`  
5. Refreshing the page keeps you logged in (thanks to `localstorage`)  
6. Typing `/profile` in URL without login redirects back to `/`

---

## üîë Important Notes

- Replace `YOUR_AUTH0_DOMAIN` and `YOUR_AUTH0_CLIENT_ID` with values from [Auth0 Dashboard](https://manage.auth0.com/).  
- Ensure the **Allowed Callback URLs** in Auth0 settings include:
  ```
  http://localhost:3000
  ```
- Use **`cacheLocation="localstorage"`** for persistent login on refresh.  
- Always wrap protected routes with `<PrivateRoutes>`.

---

‚úÖ That‚Äôs it! You now have a **fully working Auth0 authentication setup in React with protected routes**.  
